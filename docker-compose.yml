version: '3.8'

services:
  mtls-server:
    build:
      context: ./MtlsServer
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
      - "8443:8443"
    volumes:
      - ./certificates:/app/certificates:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080;https://+:8443
    networks:
      - mtls-network

  mtls-client:
    build:
      context: ./MtlsClient
      dockerfile: Dockerfile
    depends_on:
      - mtls-server
    volumes:
      - ./certificates:/app/certificates:ro
    networks:
      - mtls-network
    environment:
      - SERVER_HOST=mtls-server
    command: ["sh", "-c", "sleep 10 && dotnet MtlsClient.dll"]

networks:
  mtls-network:
    driver: bridge